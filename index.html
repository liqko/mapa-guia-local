const map = L.map('map').setView([-36.313, -57.679], 14);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap contributors'
}).addTo(map);

// Función para "normalizar" texto de categoría y armar nombre de archivo
function normalizarCategoria(nombre) {
  return nombre
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "") // elimina tildes
    .replace(/\s+/g, '-') // espacios por guiones
    .replace(/[^a-z0-9\-]/g, ''); // solo letras, números y guiones
}

fetch('https://opensheet.elk.sh/1vwzXhaK99qos9PsZo-MLysJ8okR81VZV1EXgFiweUWw/ADHERIDOS')
  .then(response => response.json())
  .then(data => {
    data.forEach(comercio => {
      if (comercio.lat && comercio.lng) {
        const lat = parseFloat(comercio.lat / 1e7);
        const lng = parseFloat(comercio.lng / 1e7);
        const categoria = normalizarCategoria(comercio.categoria || 'default');
        const iconoCategoria = L.icon({
          iconUrl: `img/${categoria}.png`,
          iconSize: [40, 40],
          iconAnchor: [20, 40],
          popupAnchor: [0, -40]
        });

        const marker = L.marker([lat, lng], { icon: iconoCategoria }).addTo(map);

        const popupHTML = `
          <div style="text-align:center;">
            <img src="${comercio.logo}" alt="${comercio.nombre}" style="width:100px;height:auto;"><br>
            <strong>${comercio.nombre}</strong><br>
            <a href="${comercio.maps}" target="_blank">¿Cómo llegar?</a>
          </div>
        `;

        marker.bindPopup(popupHTML);
      }
    });
  })
  .catch(error => {
    console.error('Error al cargar los datos:', error);
  });
